(this["webpackJsonpnarou-react"]=this["webpackJsonpnarou-react"]||[]).push([[0],{85:function(t,e,n){},93:function(t,e,n){"use strict";n.r(e);var r=n(0),a=n.n(r),c=n(9),o=n.n(c),i=(n(85),n(59)),u=n(60),s=n(67),l=n(68),d=n(34),j=n(26),b=n(36),f=n.n(b),O=n(61),h=n(52),m=n(37),v=n(134),p=n(132),g=n(122),x=n(123),k=n(135),y=n(124),w=n(125),_=n(126),S=n(136),D=n(128),C=n(127),E=n(22),L=n(54);var R=n(7);function F(t){return t.bookmark>=t.latest?"".concat(t.base_url).concat(t.latest,"/"):"".concat(t.base_url).concat(t.bookmark+1,"/")}function I(t){return t.latest>t.bookmark}function M(t){return Math.max(t.latest-t.bookmark,0)}function T(t){var e=Object(r.useState)(""),n=Object(m.a)(e,2),a=n[0],c=n[1],o=Object(r.useState)(""),i=Object(m.a)(o,2),u=i[0],s=i[1],l=Object(r.useCallback)(Object(h.a)(f.a.mark((function e(){var n,r,c,o,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=new FormData).append("id",a),n.append("password",u),console.log(n),r=Object(O.a)(n.entries());try{for(r.s();!(c=r.n()).done;)o=c.value,console.log(o[0],o[1])}catch(s){r.e(s)}finally{r.f()}return e.next=8,fetch("".concat(t.host,"/narou/login"),{method:"POST",body:n});case 8:return i=e.sent,e.next=11,i.json();case 11:e.sent&&t.onLogin();case 13:case"end":return e.stop()}}),e)}))),[a,u,t]);return Object(R.jsxs)("form",{id:"loginForm",children:[Object(R.jsx)("h2",{children:"\u5c0f\u8aac\u5bb6\u306b\u306a\u308d\u3046\u306e\u30ed\u30b0\u30a4\u30f3\u60c5\u5831"}),Object(R.jsx)(v.a,{children:Object(R.jsx)(p.a,{id:"id",name:"id",label:"ID or email",value:a,onChange:function(t){return c(t.target.value)}})}),Object(R.jsx)(v.a,{children:Object(R.jsx)(p.a,{id:"password",name:"password",label:"password",type:"password",value:u,onChange:function(t){return s(t.target.value)}})}),Object(R.jsx)(g.a,{onClick:l,children:"login"})]})}function P(t){var e=t.ignoreDuration,n=new URLSearchParams(window.location.search).get("server")||"http://localhost:7676",a=Object(r.useState)(!1),c=Object(m.a)(a,2),o=c[0],i=c[1],u=Object(r.useState)(!1),s=Object(m.a)(u,2),l=s[0],b=s[1],O=function(t,e){var n=e.ignoreDuration,a=e.enableR18,c=Object(d.b)("".concat(t,"/narou/isnoticelist"),{onErrorRetry:function(t){console.log("onErrorRetry:",t,t.status)}}),o=c.data,i=c.error,u=Object(d.b)(!i&&a?"".concat(t,"/r18/isnoticelist"):null),s=u.data,l=u.error,b=Object(r.useMemo)((function(){if(void 0!==o){var t=j.DateTime.now().minus(n);return[].concat(Object(L.a)(o.map((function(t){return Object(E.a)(Object(E.a)({},t),{},{isR18:!1})}))),Object(L.a)((s||[]).map((function(t){return Object(E.a)(Object(E.a)({},t),{},{isR18:!0})})))).map((function(t){return Object(E.a)(Object(E.a)({},t),{},{update_time:j.DateTime.fromISO(t.update_time)})})).filter((function(e){return e.update_time>t})).sort((function(t,e){return t.update_time>e.update_time?-1:t.update_time<e.update_time?1:0}))}}),[o,s,n]);return{data:i?void 0:b,error:i||l}}(n,{ignoreDuration:e,enableR18:l}),p=O.data,P=O.error,J=Object(r.useMemo)((function(){return null===p||void 0===p?void 0:p.filter((function(t){return t.bookmark<t.latest}))}),[p]),B=Object(r.useMemo)((function(){return J&&J.length>0?J[J.length-1]:void 0}),[J]),H=Object(r.useMemo)((function(){return B?F(B):void 0}),[B]);Object(r.useEffect)((function(){document.title="\u306a\u308d\u3046 \u672a\u8aad:".concat(null===J||void 0===J?void 0:J.length)}),[J]),Object(r.useEffect)((function(){if(void 0!==H){var t=function(t){"Enter"===t.key&&window.open(H,"_blank")};return document.addEventListener("keydown",t,!1),function(){document.removeEventListener("keydown",t)}}}),[H]);var z=Object(r.useCallback)(Object(h.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(n,"/narou/logout"));case 2:i(!0);case 3:case"end":return t.stop()}}),t)}))),[n]);if(o)return Object(R.jsx)(T,{host:n,onLogin:function(){return i(!1)}});if(P)return 401===P.status&&i(!0),Object(R.jsxs)("div",{children:["Server(",JSON.stringify(n),") is not working...?"]});if(!p)return Object(R.jsx)("div",{children:"Loading..."});var A=function(t){return!!B&&t.base_url===B.base_url};return Object(R.jsxs)(v.a,{m:2,display:"flex",flexDirection:"column",bgcolor:"background.paper",children:[Object(R.jsx)("p",{children:Object(R.jsx)(x.a,{label:"R18\u3092\u542b\u3081\u308b",control:Object(R.jsx)(k.a,{checked:l,onChange:function(t){return b(t.target.checked)}})})}),Object(R.jsx)("p",{children:"\u672a\u8aad: ".concat(null===J||void 0===J?void 0:J.length," \u4f5c\u54c1.")}),null===p||void 0===p?void 0:p.map((function(t){return Object(R.jsx)(v.a,{width:"100%",children:Object(R.jsx)(g.a,{variant:A(t)?"contained":"outlined",href:F(t),target:"_blank",children:Object(R.jsxs)(y.a,{children:[Object(R.jsx)(w.a,{children:Object(R.jsx)(_.a,{color:"primary",badgeContent:M(t),children:Object(R.jsx)(S.a,{children:Object(R.jsx)(C.a,{color:t.isR18?"secondary":void 0})})})}),Object(R.jsx)(D.a,{primary:I(t)?"".concat(t.title," (").concat(t.bookmark,"/").concat(t.latest,")"):"".concat(t.title," (").concat(t.latest,")"),secondary:"".concat(t.update_time.toFormat("yyyy/LL/dd HH:mm")," \u66f4\u65b0  \u4f5c\u8005:").concat(t.author_name)})]})})},t.base_url)})),Object(R.jsx)(g.a,{onClick:z,children:"logout"})]})}var J=n(66),B=n(130),H=n(129),z=n(131),A=j.Duration.fromObject({days:30});var N=function(){var t=Object(H.a)("(prefers-color-scheme: dark)"),e=Object(r.useMemo)((function(){return Object(J.a)({palette:{type:t?"dark":"light"}})}),[t]);return Object(R.jsxs)(B.a,{theme:e,children:[Object(R.jsx)(z.a,{}),Object(R.jsx)(d.a,{value:{refreshInterval:3e5,fetcher:function(t){return fetch(t,{credentials:"include"}).then((function(t){if(!t.ok){var e=new(function(t){Object(u.a)(n,t);var e=Object(s.a)(n);function n(){var t;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return(t=e.call.apply(e,[this].concat(a))).status=0,t.name="FetchError",t}return n}(Object(l.a)(Error)))("failed to fetch: status=".concat(t.status));throw e.status=t.status,e}return t.json()}))}},children:Object(R.jsx)(P,{ignoreDuration:A})}),Object(R.jsxs)("div",{style:{display:"inline-block",position:"fixed",bottom:0,right:0,fontSize:"small",fontStyle:"italic"},children:["narou-react: ",j.DateTime.fromISO("2021-04-12T17:58:08.147Z").toISO()]})]})},U=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,138)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,c=e.getLCP,o=e.getTTFB;n(t),r(t),a(t),c(t),o(t)}))};o.a.render(Object(R.jsx)(a.a.StrictMode,{children:Object(R.jsx)(N,{})}),document.getElementById("root")),U()}},[[93,1,2]]]);
//# sourceMappingURL=main.cb48f982.chunk.js.map