(this["webpackJsonpnarou-react"]=this["webpackJsonpnarou-react"]||[]).push([[0],{89:function(t,e,n){},97:function(t,e,n){"use strict";n.r(e);var r=n(0),c=n.n(r),a=n(10),o=n.n(a),i=(n(89),n(22)),u=n(32),s=n(35),l=n(11),j=n.n(l),b=n(17),d=n(16),f=n(145),h=n(126),O=n(127),p=n(128),v=n(129),x=n(143),m=n(131),k=n(146),g=n(130),y=n(132),w=n(133),C=n(134),S=n(147),_=n(136),D=n(135),F=n(59);var R=n(141),E=n(5);function L(t){var e=Object(r.useState)(""),n=Object(i.a)(e,2),c=n[0],a=n[1],o=Object(r.useState)(""),u=Object(i.a)(o,2),s=u[0],l=u[1],d=Object(r.useState)(""),m=Object(i.a)(d,2),k=m[0],g=m[1],y=Object(r.useCallback)(Object(b.a)(j.a.mark((function e(){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api.login(c,s);case 2:if((n=e.sent).ok){e.next=10;break}return e.next=6,n.text();case 6:r=e.sent,g("".concat(n.status," ").concat(n.statusText,"\n").concat(r)),e.next=11;break;case 10:t.onLogin();case 11:case"end":return e.stop()}}),e)}))),[c,s,t]),w=Object(r.useRef)(),C=Object(r.useCallback)((function(){var t;g(""),null===(t=w.current)||void 0===t||t.focus()}),[]);return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsxs)(f.a,{open:""!==k,onClose:function(){return C()},children:[Object(E.jsx)(h.a,{children:"\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f"}),Object(E.jsx)(O.a,{children:Object(E.jsx)("pre",{children:k})}),Object(E.jsx)(p.a,{children:Object(E.jsx)(v.a,{autoFocus:!0,onClick:function(){return C()},children:"OK"})})]}),Object(E.jsxs)("form",{id:"loginForm",children:[Object(E.jsx)("h2",{children:"\u5c0f\u8aac\u5bb6\u306b\u306a\u308d\u3046\u306e\u30ed\u30b0\u30a4\u30f3\u60c5\u5831"}),Object(E.jsx)(x.a,{children:Object(E.jsx)(R.a,{id:"id",name:"id",label:"ID or email",autoFocus:!0,value:c,onChange:function(t){return a(t.target.value)},onKeyPress:function(t){var e;"Enter"===t.key&&(null===(e=w.current)||void 0===e||e.focus())}})}),Object(E.jsx)(x.a,{children:Object(E.jsx)(R.a,{id:"password",name:"password",label:"password",type:"password",value:s,onChange:function(t){return l(t.target.value)},inputRef:w,onKeyPress:function(t){"Enter"===t.key&&y()}})}),Object(E.jsx)(v.a,{onClick:y,children:"login"})]})]})}function T(t){return t.bookmark>=t.latest?"".concat(t.base_url).concat(t.latest,"/"):"".concat(t.base_url).concat(t.bookmark+1,"/")}function I(t){return t.latest>t.bookmark}function M(t){return Math.max(t.latest-t.bookmark,0)}function P(t){return t.latest<t.bookmark?{color:"secondary",badgeContent:"!"}:{color:"primary",badgeContent:M(t)}}function z(t){var e=t.item,n=t.onClose;return Object(E.jsxs)(f.a,{open:!!e,onClose:n,children:[Object(E.jsx)(h.a,{children:null===e||void 0===e?void 0:e.title}),Object(E.jsxs)(O.a,{children:["\u4f5c\u8005:",null===e||void 0===e?void 0:e.author_name]}),Object(E.jsxs)(p.a,{children:[Object(E.jsx)(v.a,{variant:"contained",onClick:function(){e&&window.open(e.base_url,"_blank"),n()},children:"\u5c0f\u8aac\u30da\u30fc\u30b8"}),Object(E.jsxs)(v.a,{variant:"contained",onClick:function(){e&&window.open(T(e),"_blank"),n()},children:["\u6700\u65b0",null===e||void 0===e?void 0:e.latest,"\u90e8\u5206"]}),Object(E.jsx)(v.a,{variant:"contained",onClick:function(){return n()},children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})}function H(t){var e=t.server,n=t.ignoreDuration,c=t.onUnauthorized,a=Object(r.useState)(!1),o=Object(i.a)(a,2),l=o[0],f=o[1],h=function(t,e){var n=e.ignoreDuration,c=e.enableR18,a=Object(u.b)("/narou/isnoticelist",function(){var e=Object(b.a)(j.a.mark((function e(n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.call(n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{onErrorRetry:function(t){console.log("onErrorRetry:",t,t.status)}}),o=a.data,i=a.error,l=Object(u.b)(!i&&c?"/r18/isnoticelist":null,function(){var e=Object(b.a)(j.a.mark((function e(n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.call(n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),f=l.data,h=l.error,O=Object(r.useMemo)((function(){if(void 0!==o){var t=s.DateTime.now().minus(n);return[].concat(Object(F.a)(o.map((function(t){return Object(d.a)(Object(d.a)({},t),{},{isR18:!1})}))),Object(F.a)((f||[]).map((function(t){return Object(d.a)(Object(d.a)({},t),{},{isR18:!0})})))).map((function(t){return Object(d.a)(Object(d.a)({},t),{},{update_time:s.DateTime.fromISO(t.update_time)})})).filter((function(e){return e.update_time>t})).sort((function(t,e){return t.update_time>e.update_time?-1:t.update_time<e.update_time?1:0}))}}),[o,f,n]);return{data:i?void 0:O,error:i||h}}(e,{ignoreDuration:n,enableR18:l}),O=h.data,p=h.error,v=Object(r.useMemo)((function(){return null===O||void 0===O?void 0:O.filter((function(t){return t.bookmark<t.latest}))}),[O]),R=Object(r.useMemo)((function(){return v&&v.length>0?v[v.length-1]:void 0}),[v]),L=Object(r.useState)(void 0),H=Object(i.a)(L,2),J=H[0],K=H[1];if(Object(r.useEffect)((function(){document.title="\u306a\u308d\u3046 \u672a\u8aad:".concat(null===v||void 0===v?void 0:v.length)}),[v]),p)return console.log("error =",p),401===p.status&&c(),Object(E.jsxs)("div",{children:["Server(",JSON.stringify(e),") is not working...?"]});if(!O)return Object(E.jsx)("div",{children:"Loading..."});return Object(E.jsxs)(x.a,{m:2,display:"flex",flexDirection:"column",bgcolor:"background.paper",children:[Object(E.jsx)(z,{item:J,onClose:function(){return K(void 0)}}),Object(E.jsx)("p",{children:Object(E.jsx)(m.a,{label:"R18\u3092\u542b\u3081\u308b",control:Object(E.jsx)(k.a,{checked:l,onChange:function(t){return f(t.target.checked)}})})}),Object(E.jsx)("p",{children:"\u672a\u8aad: ".concat(null===v||void 0===v?void 0:v.length," \u4f5c\u54c1.")}),Object(E.jsx)(g.a,{children:null===O||void 0===O?void 0:O.map((function(t){return Object(E.jsxs)(y.a,Object(d.a)(Object(d.a)(Object(d.a)({button:!0},function(t){return!!R&&t.base_url===R.base_url}(t)?{selected:!0,autoFocus:!0}:{}),function(t){return M(t)>0?{component:"a",href:T(t),target:"_blank"}:{onClick:function(){return K(t)}}}(t)),{},{children:[Object(E.jsx)(w.a,{children:Object(E.jsx)(C.a,Object(d.a)(Object(d.a)({overlap:"circle"},P(t)),{},{children:Object(E.jsx)(S.a,{children:Object(E.jsx)(D.a,{color:t.isR18?"secondary":void 0})})}))}),Object(E.jsx)(_.a,{primary:I(t)?"".concat(t.title," (").concat(t.bookmark,"/").concat(t.latest,")"):"".concat(t.title," (").concat(t.latest,")"),secondary:"".concat(t.update_time.toFormat("yyyy/LL/dd HH:mm")," \u66f4\u65b0  \u4f5c\u8005:").concat(t.author_name)})]}),t.base_url)}))})]})}function J(t){var e=t.api,n=t.ignoreDuration,c=Object(r.useState)(!1),a=Object(i.a)(c,2),o=a[0],s=a[1];return Object(r.useEffect)((function(){Object(u.c)("/narou/isnoticelist"),Object(u.c)("/r18/isnoticelist")}),[o]),o?Object(E.jsx)(L,{api:e,onLogin:function(){console.log("logged in!"),s(!1)}}):Object(E.jsxs)(x.a,{children:[Object(E.jsx)(H,{server:e,ignoreDuration:n,onUnauthorized:function(){return s(!0)}}),Object(E.jsx)(v.a,{onClick:Object(b.a)(j.a.mark((function t(){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.logout();case 2:s(!0);case 3:case"end":return t.stop()}}),t)}))),children:"logout"})]})}var K=n(73),U=n(138),B=n(137),$=n(33),G=n(139),N=n(140),Z=n(71),q=n(72),A=function(){function t(e){Object(Z.a)(this,t),this.server=void 0,this.server=e.replace(/\/$/,"")}return Object(q.a)(t,[{key:"fetch",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){var t=Object(b.a)(j.a.mark((function t(e){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",fetch("".concat(this.server).concat(e),{credentials:"include"}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}())},{key:"login",value:function(){var t=Object(b.a)(j.a.mark((function t(e,n){var r,c;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new FormData).append("id",e),r.append("password",n),t.next=5,fetch("".concat(this.server,"/narou/login"),{method:"POST",body:r,credentials:"include"});case 5:return c=t.sent,t.abrupt("return",c);case 7:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"logout",value:function(){var t=Object(b.a)(j.a.mark((function t(){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.fetch("/narou/logout");case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"call",value:function(){var t=Object(b.a)(j.a.mark((function t(e){var n;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.fetch(e);case 2:if((n=t.sent).ok){t.next=5;break}throw n;case 5:return t.abrupt("return",n.json());case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),Q=s.Duration.fromObject({days:30});var V=function(){var t=Object(B.a)("(prefers-color-scheme: dark)"),e=Object(r.useMemo)((function(){return Object(K.a)({palette:{type:t?"dark":"light"}})}),[t]),n=Object(r.useState)(null),c=Object(i.a)(n,2),a=c[0],o=c[1];return Object(r.useEffect)((function(){var t,e=(t=document.location,new URLSearchParams(t.search).get("server")||("http:"===t.protocol?"http://localhost:7676":/.*\.github\.io$/.test(t.hostname)?"":t.protocol+"//"+t.host+t.pathname));o(e?new A(e):null)}),[]),a?Object(E.jsxs)(U.a,{theme:e,children:[Object(E.jsx)(N.a,{}),Object(E.jsx)(u.a,{value:{refreshInterval:3e5},children:Object(E.jsx)(J,{api:a,ignoreDuration:Q})}),Object(E.jsxs)("div",{style:{display:"inline-block",position:"fixed",bottom:0,right:0,fontSize:"small",fontStyle:"italic"},children:["narou-react: ",s.DateTime.fromISO("2021-04-26T11:39:14.026Z").toISO()]})]}):Object(E.jsxs)(U.a,{theme:e,children:[Object(E.jsx)($.a,{children:"http\u4ee5\u5916\u306e\u5834\u5408\u306f\u5fc5\u305a server \u30af\u30a8\u30ea\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u30b5\u30fc\u30d0\u30fc\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044"}),Object(E.jsx)(G.a,{href:"https://github.com/koizuka/narou-watcher/",children:"GitHub"})]})},W=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,150)).then((function(e){var n=e.getCLS,r=e.getFID,c=e.getFCP,a=e.getLCP,o=e.getTTFB;n(t),r(t),c(t),a(t),o(t)}))};o.a.render(Object(E.jsx)(c.a.StrictMode,{children:Object(E.jsx)(V,{})}),document.getElementById("root")),W()}},[[97,1,2]]]);
//# sourceMappingURL=main.dd8a298a.chunk.js.map