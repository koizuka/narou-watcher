(this["webpackJsonpnarou-react"]=this["webpackJsonpnarou-react"]||[]).push([[0],{52:function(e,t,n){},58:function(e,t,n){"use strict";n.r(t);var c=n(0),o=n.n(c),r=n(10),a=n.n(r),i=(n(52),n(15)),u=n(17),s=n(29),l=n(81),d=n(74),b=n(75),j=n(82),f=n(83),m=n(76),O=n(77),h=n(84),v=n(79),g=n(78),k=n(16),p=n(33);var x=n(6);function y(e){return e.bookmark>=e.latest?"".concat(e.base_url).concat(e.latest,"/"):"".concat(e.base_url).concat(e.bookmark+1,"/")}function w(e){var t=e.ignoreDuration,n=new URLSearchParams(window.location.search),o=n.get("server")||"http://localhost:7676",r=function(e){var t=Object(c.useState)("connect"),n=Object(s.a)(t,2),o=n[0],r=n[1],a=Object(i.b)("dummy",(function(){return!0})).isValidating;return Object(c.useEffect)((function(){if(e&&"connect"===o){r("connecting");try{var t=new WebSocket(e);t.onopen=function(){console.log("websocket: connected."),r("connected")},t.onmessage=function(e){console.log("websocket: msg = '".concat(e.data,"'"))},t.onclose=function(){console.log("websocket: closed."),r("not connected")},t.onerror=function(e){console.log("websocket: error: ",e),r("not connected")}}catch(n){console.log("WebSocket error: ",n),r("not connected")}}}),[e,o]),Object(c.useEffect)((function(){if(e&&a)switch(o){case"not connected":console.log("retry"),r("connect")}}),[a,o,e]),{connected:"connected"===o}}(n.get("ws")).connected,a=Object(c.useState)(!1),w=Object(s.a)(a,2),_=w[0],S=w[1],D=function(e,t){var n=t.ignoreDuration,o=t.enableR18,r=Object(i.b)("".concat(e,"/narou/isnoticelist")),a=r.data,s=r.error,l=Object(i.b)(!s&&o?"".concat(e,"/r18/isnoticelist"):null),d=l.data,b=l.error,j=Object(c.useMemo)((function(){if(void 0!==a){var e=u.DateTime.now().minus(n);return[].concat(Object(p.a)(a.map((function(e){return Object(k.a)(Object(k.a)({},e),{},{isR18:!1})}))),Object(p.a)((d||[]).map((function(e){return Object(k.a)(Object(k.a)({},e),{},{isR18:!0})})))).map((function(e){return Object(k.a)(Object(k.a)({},e),{},{update_time:u.DateTime.fromISO(e.update_time)})})).filter((function(t){return t.update_time>e})).sort((function(e,t){return e.update_time>t.update_time?-1:e.update_time<t.update_time?1:0}))}}),[a,d,n]);return{data:s?void 0:j,error:s||b}}(o,{ignoreDuration:t,enableR18:_}),E=D.data,L=D.error,R=Object(c.useMemo)((function(){return null===E||void 0===E?void 0:E.filter((function(e){return e.bookmark<e.latest}))}),[E]),I=Object(c.useMemo)((function(){return R&&R.length>0?y(R[0]):void 0}),[R]);return Object(c.useEffect)((function(){document.title="\u306a\u308d\u3046 \u672a\u8aad:".concat(null===R||void 0===R?void 0:R.length).concat(r?" ws":"")}),[R,r]),Object(c.useEffect)((function(){if(void 0!==I){var e=function(e){"Enter"===e.key&&window.open(I,"_blank")};return document.addEventListener("keydown",e,!1),function(){document.removeEventListener("keydown",e)}}}),[I]),L?Object(x.jsxs)("div",{children:["Server(",JSON.stringify(o),") is not working...?"]}):E?Object(x.jsxs)(l.a,{m:2,display:"flex",flexDirection:"column",bgcolor:"background.paper",children:[null===R||void 0===R?void 0:R.map((function(e,t){return Object(x.jsx)(d.a,{variant:"contained",color:t?void 0:"primary",href:y(e),target:"_blank",children:"".concat(e.title,"(").concat(e.bookmark+1,"\u90e8\u5206)\u3092\u958b\u304f").concat(t?"":" [Enter]")},e.base_url)})),Object(x.jsx)("p",{children:Object(x.jsx)(b.a,{label:"R18\u3092\u542b\u3081\u308b",control:Object(x.jsx)(j.a,{checked:_,onChange:function(e){return S(e.target.checked)}})})}),Object(x.jsx)("p",{children:"\u672a\u8aad: ".concat(null===R||void 0===R?void 0:R.length," \u4f5c\u54c1.")}),null===E||void 0===E?void 0:E.map((function(e){return Object(x.jsx)(l.a,{width:"100%",children:Object(x.jsx)(d.a,{variant:"outlined",href:y(e),target:"_blank",children:Object(x.jsxs)(f.a,{children:[Object(x.jsx)(m.a,{children:Object(x.jsx)(O.a,{color:"primary",badgeContent:Math.max(e.latest-e.bookmark,0),children:Object(x.jsx)(h.a,{children:Object(x.jsx)(g.a,{color:e.isR18?"secondary":void 0})})})}),Object(x.jsx)(v.a,{primary:e.bookmark<e.latest?"".concat(e.title," (").concat(e.bookmark,"/").concat(e.latest,")"):"".concat(e.title," (").concat(e.latest,")"),secondary:"".concat(e.update_time.toFormat("yyyy/LL/dd HH:mm")," \u66f4\u65b0  \u4f5c\u8005:").concat(e.author_name)})]})})},e.base_url)}))]}):Object(x.jsx)("div",{children:"Loading..."})}var _=u.Duration.fromObject({days:30});var S=function(){return Object(x.jsxs)("div",{className:"App",children:[Object(x.jsx)(i.a,{value:{refreshInterval:3e5,fetcher:function(e){return fetch(e).then((function(e){return e.json()}))}},children:Object(x.jsx)(w,{ignoreDuration:_})}),Object(x.jsxs)("div",{style:{display:"inline-block",position:"fixed",bottom:0,right:0,fontSize:"small",fontStyle:"italic"},children:["narou-react: ",u.DateTime.fromISO("2021-04-04T16:20:23.343Z").toISO()]})]})},D=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,87)).then((function(t){var n=t.getCLS,c=t.getFID,o=t.getFCP,r=t.getLCP,a=t.getTTFB;n(e),c(e),o(e),r(e),a(e)}))};a.a.render(Object(x.jsx)(o.a.StrictMode,{children:Object(x.jsx)(S,{})}),document.getElementById("root")),D()}},[[58,1,2]]]);
//# sourceMappingURL=main.bce0e09c.chunk.js.map