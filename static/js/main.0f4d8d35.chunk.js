(this["webpackJsonpnarou-react"]=this["webpackJsonpnarou-react"]||[]).push([[0],{100:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(10),o=n.n(c),u=(n(92),n(14)),i=n(24),s=n(47),l=n(11),b=n.n(l),j=n(16),f=n(18),d=n(145),O=n(162),h=n(103),p=n(146),v=n(147),k=n(148),m=n(160),x=n(149),g=n(161),y=n(137),w=n(142),C=n(150),S=n(151),_=n(152),E=n(163),R=n(154),I=n(153),F=n(44),M=n(69),P=n(70),z=function(){function e(t){Object(M.a)(this,e),this.server=void 0,this.server=t.replace(/\/$/,"")}return Object(P.a)(e,[{key:"fetch",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=Object(j.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(this.server).concat(t),{credentials:"include"}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}())},{key:"login",value:function(){var e=Object(j.a)(b.a.mark((function e(t,n){var r,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FormData).append("id",t),r.append("password",n),e.next=5,fetch("".concat(this.server,"/narou/login"),{method:"POST",body:r,credentials:"include"});case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(j.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch("/narou/logout");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"call",value:function(){var e=Object(j.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(t);case 2:if((n=e.sent).ok){e.next=5;break}throw n;case 5:return e.abrupt("return",n.json());case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"isnoticelist",value:function(e){var t=e.maxPage;return"/narou/isnoticelist?max_page=".concat(void 0===t?1:t)}},{key:"isnoticelistR18",value:function(e){var t=e.maxPage;return"/r18/isnoticelist?max_page=".concat(void 0===t?1:t)}},{key:"bookmarks",value:function(){return"/narou/bookmarks"}},{key:"bookmarksR18",value:function(){return"/r18/bookmarks"}},{key:"bookmark",value:function(e,t){var n=t.order;return"/narou/bookmarks/".concat(e,"?order=").concat(n)}},{key:"bookmarkR18",value:function(e,t){var n=t.order;return"/r18/bookmarks/".concat(e,"?order=").concat(n)}},{key:"novelInfo",value:function(e){return"/narou/novels/".concat(e)}},{key:"novelInfoR18",value:function(e){return"/r18/novels/".concat(e)}}]),e}();function D(){Object(i.c)("/narou/isnoticelist"),Object(i.c)("/r18/isnoticelist")}function L(e,t,n){var r=n(e),a=n(t);return r<a?-1:r>a?1:0}function T(e,t){var n=t.enableR18,a=t.maxPage,c=void 0===a?1:a,o=t.bookmark1,u=void 0!==o&&o,l=Object(i.b)(z.isnoticelist({maxPage:c}),function(){var t=Object(j.a)(b.a.mark((function t(n){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.call(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),{onErrorRetry:function(e){console.log("onErrorRetry:",e,e.status)}}),d=l.data,O=l.error,h=Object(i.b)(!O&&u?z.bookmark(1,{order:"new"}):null,function(){var t=Object(j.a)(b.a.mark((function t(n){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.call(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),p=h.data,v=h.error,k=Object(i.b)(!O&&n?z.isnoticelistR18({maxPage:c}):null,function(){var t=Object(j.a)(b.a.mark((function t(n){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.call(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),m=k.data,x=k.error,g=Object(r.useMemo)((function(){if(d&&p){var e=new Set(d.map((function(e){return e.base_url}))),t=p.filter((function(t){return t.is_notice&&!e.has(t.base_url)}));if(t.length>0)return[].concat(Object(F.a)(d),Object(F.a)(t))}return d}),[d,p]),y=Object(r.useMemo)((function(){if(void 0!==g){return[].concat(Object(F.a)(g.map((function(e){return Object(f.a)(Object(f.a)({},e),{},{isR18:!1})}))),Object(F.a)((m||[]).map((function(e){return Object(f.a)(Object(f.a)({},e),{},{isR18:!0})})))).map((function(e){return Object(f.a)(Object(f.a)({},e),{},{update_time:s.DateTime.fromISO(e.update_time)})})).sort((function(e,t){return function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];for(var c=0,o=r;c<o.length;c++){var u=o[c],i=void 0;if(i="object"===typeof u?L(t,e,u.f):L(e,t,u))return i}return 0}(e,t,(function(e){return function(e){return e.bookmark===e.latest?Number.MAX_SAFE_INTEGER:e.bookmark>e.latest?Number.MAX_SAFE_INTEGER-1:e.latest-e.bookmark}(e)}),e.bookmark<e.latest?function(e){return e.update_time}:{f:function(e){return e.update_time}},(function(e){return e.base_url}))})).slice(0,30)}}),[g,m]);return{data:O?void 0:y,error:O||x||v}}function A(e){return e.latest>e.bookmark}function N(e){return A(e)?"".concat(e.base_url).concat(e.bookmark+1,"/"):"".concat(e.base_url).concat(e.latest,"/")}function H(e){var t=[e.title," ("];return A(e)&&t.push("".concat(e.bookmark,"/")),t.push("".concat(e.latest,")")),e.completed&&t.push("[\u5b8c\u7d50]"),t.join("")}function U(e){return Math.max(e.latest-e.bookmark,0)}var B=n(132),G=n(134),J=n(135),K=n(136),$=n(138),X=n(139),Z=n(140),V=n(141),W=n(159),q=n(143),Q=n(5);function Y(e){var t=Object(r.useState)(""),n=Object(u.a)(t,2),a=n[0],c=n[1],o=Object(r.useState)(""),i=Object(u.a)(o,2),s=i[0],l=i[1],f=Object(r.useState)(""),d=Object(u.a)(f,2),O=d[0],h=d[1],p=Object(r.useCallback)(Object(j.a)(b.a.mark((function t(){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api.login(a,s);case 2:if((n=t.sent).ok){t.next=10;break}return t.next=6,n.text();case 6:r=t.sent,h("".concat(n.status," ").concat(n.statusText,"\n").concat(r)),t.next=11;break;case 10:e.onLogin();case 11:case"end":return t.stop()}}),t)}))),[a,s,e]),v=Object(r.useRef)(),k=Object(r.useCallback)((function(){var e;h(""),null===(e=v.current)||void 0===e||e.focus()}),[]);return Object(Q.jsxs)(Q.Fragment,{children:[Object(Q.jsxs)(B.a,{open:""!==O,onClose:function(){return k()},children:[Object(Q.jsx)(G.a,{children:"\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f"}),Object(Q.jsx)(J.a,{children:Object(Q.jsx)("pre",{children:O})}),Object(Q.jsx)(K.a,{children:Object(Q.jsx)(y.a,{autoFocus:!0,onClick:function(){return k()},children:"OK"})})]}),Object(Q.jsx)($.a,{maxWidth:"sm",children:Object(Q.jsxs)(X.a,{raised:!0,children:[Object(Q.jsx)(Z.a,{title:"\u5c0f\u8aac\u5bb6\u306b\u306a\u308d\u3046\u306e\u30ed\u30b0\u30a4\u30f3\u60c5\u5831"}),Object(Q.jsx)(V.a,{children:Object(Q.jsxs)(m.a,{display:"flex",flexDirection:"column",justifyContent:"center",children:[Object(Q.jsx)(W.a,{id:"id",name:"id",label:"ID or email",autoFocus:!0,value:a,onChange:function(e){return c(e.target.value)},onKeyPress:function(e){var t;"Enter"===e.key&&(null===(t=v.current)||void 0===t||t.focus())}}),Object(Q.jsx)(W.a,{id:"password",name:"password",label:"password",type:"password",value:s,onChange:function(e){return l(e.target.value)},inputRef:v,onKeyPress:function(e){"Enter"===e.key&&p()}})]})}),Object(Q.jsx)(q.a,{style:{justifyContent:"center"},children:Object(Q.jsx)(y.a,{variant:"contained",onClick:p,children:"login"})})]})})]})}var ee=n(76),te=n(144);function ne(e,t){var n=Object(r.useMemo)((function(){return function(e){if(!e)return null;var t=e.match(/https:\/\/([a-zA-Z.]+)\/([0-9a-z]+)\/?/);if(!t)return null;var n=Object(u.a)(t,3);return{host:n[1],ncode:n[2]}}(t)}),[t]),a=Object(r.useMemo)((function(){switch(null===n||void 0===n?void 0:n.host){case"ncode.syosetu.com":return z.novelInfo(n.ncode);case"novel18.syosetu.com":return z.novelInfoR18(n.ncode);default:return null}}),[n]),c=Object(i.b)(a,function(){var t=Object(j.a)(b.a.mark((function t(n){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.call(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());return{data:c.data,error:c.error}}function re(e){var t=e.api,n=e.item,r=e.onClose,a=ne(t,null===n||void 0===n?void 0:n.base_url).data;return Object(Q.jsxs)(B.a,{open:!!n,onClose:r,children:[Object(Q.jsx)(G.a,{children:null===n||void 0===n?void 0:n.title}),Object(Q.jsxs)(J.a,{children:["\u4f5c\u8005:",Object(Q.jsx)(te.a,{href:null===a||void 0===a?void 0:a.author_url,target:"_blank",children:null===n||void 0===n?void 0:n.author_name})]}),Object(Q.jsxs)(K.a,{children:[Object(Q.jsx)(y.a,{size:"small",variant:"contained",onClick:function(){n&&window.open(n.base_url,"_blank"),r()},children:"\u5c0f\u8aac\u30da\u30fc\u30b8"}),Object(Q.jsxs)(y.a,{size:"small",variant:"contained",onClick:function(){n&&window.open(N(n),"_blank"),r()},children:["\u6700\u65b0",null===n||void 0===n?void 0:n.latest,"\u90e8\u5206"]}),Object(Q.jsx)(y.a,{size:"small",variant:"contained",onClick:function(){return r()},children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})}var ae=Object(d.a)((function(e){return Object(O.a)({backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"}})}));function ce(e){return e.latest<e.bookmark?{color:"secondary",badgeContent:"!"}:{color:"primary",badgeContent:U(e)}}function oe(e){return e?2:1}function ue(e){var t=e.server,n=e.onUnauthorized,a=ae(),c=Object(r.useState)(!1),o=Object(u.a)(c,2),i=o[0],s=o[1],l=Object(r.useState)(oe(!1)),b=Object(u.a)(l,2),j=b[0],d=b[1],O=Object(r.useState)(!1),F=Object(u.a)(O,2),M=F[0],P=F[1],z=T(t,{enableR18:i,maxPage:j,bookmark1:M}),D=z.data,L=z.error,A=Object(r.useMemo)((function(){return D?D.filter((function(e){return e.bookmark<e.latest})).length:null}),[D]),B=Object(r.useState)(void 0),G=Object(u.a)(B,2),J=G[0],K=G[1],$=Object(r.useState)(-1),X=Object(u.a)($,2),Z=X[0],V=X[1],W=Object(r.useState)(-1),q=Object(u.a)(W,2),Y=q[0],te=q[1];Object(r.useEffect)((function(){null!==A&&(document.title="\u306a\u308d\u3046 \u672a\u8aad:".concat(A))}),[A]);var ne=Object(r.useCallback)((function(e){e&&(Object(ee.a)(e,{behavior:"smooth",scrollMode:"if-needed"}),e.focus())}),[]);Object(r.useEffect)((function(){V(-1)}),[i,j]),Object(r.useEffect)((function(){var e=D&&D.length>0&&U(D[0])>0?0:-1;te(e),V(e)}),[D]);var ue=Object(r.useRef)(null);Object(r.useEffect)((function(){var e;-1===Z&&(null===(e=ue.current)||void 0===e||e.focus())}),[Z]),Object(r.useEffect)((function(){if(D){var e=function(e){var t=D.length;switch(e.key){case"ArrowUp":Z>0&&e.preventDefault(),V((function(e){return e>0?e-1:0}));break;case"ArrowDown":Z<t-1&&e.preventDefault(),V((function(e){return e<t?e+1:t-1}));break;case"Home":V(0);break;case"End":V(t-1);break;case"Escape":V(Y);break;case"r":s((function(e){return!e}));break;case"b":P((function(e){return!e}));break;case"1":d((function(e){return oe(e===oe(!1))}))}};return document.addEventListener("keydown",e,!1),function(){document.removeEventListener("keydown",e)}}}),[Z,Y,D]);var ie=Object(r.useCallback)((function(e){return U(e)>0?{component:"a",href:N(e),onClick:function(){return V(-1)},target:"_blank"}:{onClick:function(){return K(e)}}}),[K]);return L?(console.log("error =",L),401===L.status&&n(),Object(Q.jsxs)("div",{children:["Server(",JSON.stringify(t),") is not working...? status: $",L.status]})):D?Object(Q.jsxs)(Q.Fragment,{children:[Object(Q.jsx)(re,{api:t,item:J,onClose:function(){return K(void 0)}}),Object(Q.jsx)(v.a,{position:"sticky",children:Object(Q.jsxs)(k.a,{children:[Object(Q.jsx)(m.a,{children:Object(Q.jsx)(x.a,{label:"R18",control:Object(Q.jsx)(g.a,{checked:i,onChange:function(e){return s(e.target.checked)}})})}),Object(Q.jsx)(m.a,{children:Object(Q.jsx)(x.a,{label:"BM1",control:Object(Q.jsx)(g.a,{checked:M,onChange:function(e){return P(e.target.checked)}})})}),Object(Q.jsxs)(m.a,{m:2,children:["\u672a\u8aad: ",null!==A&&void 0!==A?A:""]}),Object(Q.jsx)(y.a,{variant:"contained",disabled:0===Z,disableRipple:!0,ref:ue,onClick:function(){return V(Y)},children:"ESC"})]})}),Object(Q.jsx)(m.a,{m:2,display:"flex",flexDirection:"column",bgcolor:"background.paper",children:Object(Q.jsx)(w.a,{children:null===D||void 0===D?void 0:D.map((function(e,t){return Object(Q.jsxs)(C.a,Object(f.a)(Object(f.a)(Object(f.a)({button:!0},t===Z?{selected:!0,ref:ne}:{}),{},{disableRipple:!0,onFocusVisible:function(){return V(t)}},ie(e)),{},{children:[Object(Q.jsx)(S.a,{children:Object(Q.jsx)(_.a,Object(f.a)(Object(f.a)({overlap:"circle"},ce(e)),{},{children:Object(Q.jsx)(E.a,{children:Object(Q.jsx)(I.a,{color:e.isR18?"secondary":void 0})})}))}),Object(Q.jsx)(R.a,{primary:H(e),secondary:"".concat(e.update_time.toFormat("yyyy/LL/dd HH:mm")," \u66f4\u65b0  \u4f5c\u8005:").concat(e.author_name)})]}),e.base_url)}))})})]}):Object(Q.jsx)(h.a,{className:a.backdrop,open:!0,children:Object(Q.jsx)(p.a,{color:"inherit"})})}function ie(e){var t=e.api,n=Object(r.useState)(!1),a=Object(u.a)(n,2),c=a[0],o=a[1];return c?Object(Q.jsx)(Y,{api:t,onLogin:function(){console.log("logged in!"),D(),o(!1)}}):Object(Q.jsxs)(Q.Fragment,{children:[Object(Q.jsx)(ue,{server:t,onUnauthorized:function(){D(),o(!0)}}),Object(Q.jsx)(y.a,{onClick:Object(j.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.logout();case 2:D(),o(!0);case 4:case"end":return e.stop()}}),e)}))),children:"logout"})]})}var se=n(75),le=n(157),be=n(155),je=n(19),fe=n(158),de=n(156);var Oe=function(){var e=Object(be.a)("(prefers-color-scheme: dark)"),t=Object(r.useMemo)((function(){return Object(se.a)({palette:{type:e?"dark":"light",primary:de.a}})}),[e]),n=Object(r.useState)(null),a=Object(u.a)(n,2),c=a[0],o=a[1],l=Object(r.useState)(!1),b=Object(u.a)(l,2),j=b[0],f=b[1];return Object(r.useEffect)((function(){var e,t=(e=document.location,new URLSearchParams(e.search).get("server")||("http:"===e.protocol?"http://localhost:7676":/.*\.github\.io$/.test(e.hostname)?"":e.protocol+"//"+e.host+e.pathname));t?o(new z(t)):f(!0)}),[]),j?Object(Q.jsxs)(le.a,{theme:t,children:[Object(Q.jsx)(je.a,{children:"http\u4ee5\u5916\u306e\u5834\u5408\u306f\u5fc5\u305a server \u30af\u30a8\u30ea\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u30b5\u30fc\u30d0\u30fc\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044"}),Object(Q.jsx)(te.a,{href:"https://github.com/koizuka/narou-watcher/",children:"GitHub"})]}):Object(Q.jsxs)(le.a,{theme:t,children:[Object(Q.jsx)(fe.a,{}),Object(Q.jsx)(i.a,{value:{refreshInterval:3e5},children:c&&Object(Q.jsx)(ie,{api:c})}),Object(Q.jsxs)("div",{style:{display:"inline-block",position:"fixed",bottom:0,right:0,fontSize:"small",fontStyle:"italic"},children:["narou-react: ",s.DateTime.fromISO("2021-05-24T10:10:16.763Z").toISO()]})]})},he=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,165)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),c(e),o(e)}))};o.a.render(Object(Q.jsx)(a.a.StrictMode,{children:Object(Q.jsx)(Oe,{})}),document.getElementById("root")),he()},92:function(e,t,n){}},[[100,1,2]]]);
//# sourceMappingURL=main.0f4d8d35.chunk.js.map