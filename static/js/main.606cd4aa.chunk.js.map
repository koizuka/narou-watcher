{"version":3,"sources":["narouApi/ApiError.ts","narouApi/NarouApi.ts","BookmarkSelector.tsx","narouApi/IsNoticeListItem.tsx","narouApi/useBookmarkInfo.ts","narouApi/useIsNoticeList.tsx","NarouLoginForm.tsx","narouApi/useNovelInfo.tsx","OpenConfirmDialog.tsx","reducer/ItemsState.tsx","useHotKeys.tsx","NarouUpdates.tsx","useAppBadge.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["ApiError","status","message","name","Error","NarouApi","server","this","replace","api","a","fetch","credentials","id","password","formData","FormData","append","method","body","res","key","ok","text","json","maxPage","console","log","no","order","ncode","BookmarkSelector","bookmarks","bookmark","setBookmark","onChangeBookmark","useState","open","setOpen","large","breakpoint","theme","useTheme","useMediaQuery","breakpoints","up","useIsWidthUp","Select","disableUnderline","variant","onOpen","onClose","value","onChange","event","Number","target","MenuItem","Object","keys","map","k","hasUnread","item","latest","nextLink","base_url","itemSummary","fields","title","push","completed","join","unread","Math","max","useBookmarkInfo","r18","useSWR","bookmarksR18","call","data","error","useMemo","reduce","d","num_items","clearCache","mutate","NarouLoginForm","props","userId","setUserId","setPassword","setError","postLogin","useCallback","login","statusText","onLogin","passwordRef","useRef","closeError","current","focus","Dialog","DialogTitle","DialogContent","DialogActions","Button","autoFocus","onClick","Container","maxWidth","Card","raised","CardHeader","data-testid","CardContent","Box","display","flexDirection","justifyContent","TextField","label","e","onKeyPress","type","inputRef","CardActions","style","useNovelInfo","info","m","match","warn","host","extractInfoPath","novelInfo","novelInfoR18","path","OpenConfirmDialog","bookmarkInfo","bookmark_no","isR18","bookmark_url","url","Link","href","author_url","author_name","size","window","InitialItemsState","numNewItems","selectedIndex","defaultIndex","itemsStateReducer","state","action","items","sort","b","cmps","f","c","ascend","compare","i","score","update_time","slice","head","index","filter","length","min","fa","fb","MAX_SAFE_INTEGER","toKeyString","shiftKey","undefined","ctrlKey","altKey","metaKey","s","useHotKeys","hotkeys","setHotkeys","useEffect","forEach","keyString","endsWith","split","reverse","elems","availableModifiers","some","includes","shouldBe","checkKeyString","onKeyDown","handler","document","addEventListener","removeEventListener","UserTopURL","useStyles","makeStyles","createStyles","backdrop","zIndex","drawer","color","badgeProps","badgeContent","maxPageValue","sw","NarouUpdateList","onUnauthorized","classes","enableR18","setEnableR18","setMaxPage","isnoticelist","onErrorRetry","raw_items","bookmark_items","bookmark_error","isnoticelistR18","raw_items18","error18","raw_items2","Set","adds","is_notice","has","DateTime","fromISO","useIsNoticeList","rawItems","useReducer","dispatch","setSelectedIndex","confirm","setConfirm","navigator","setAppBadge","count","clearAppBadge","Promise","resolve","setClientBadge","clearClientBadge","scrollIn","node","scrollIntoView","behavior","scrollMode","defaultRef","setHotKeys","len","arrowUp","preventDefault","arrowDown","v","cur","numbers","nextBookmark","findIndex","prevBookmark","buttonProps","component","disabled","location","reload","JSON","stringify","baseUrl","AppBar","position","Toolbar","FormControlLabel","control","Switch","checked","disableRipple","ref","alignItems","bgcolor","List","ListItem","button","selected","onFocusVisible","ListItemAvatar","Badge","overlap","Avatar","Book","ListItemText","primary","secondary","toFormat","ListItemSecondaryAction","IconButton","edge","Info","right","bottom","Fab","Backdrop","className","CircularProgress","NarouUpdates","loginMode","setLoginMode","setTimeout","logout","App","prefersDarkMode","createTheme","palette","mode","cyan","setApi","hostError","setHostError","URLSearchParams","search","get","protocol","test","hostname","pathname","StyledEngineProvider","injectFirst","ThemeProvider","Typography","CssBaseline","refreshInterval","fontSize","fontStyle","toISO","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.606cd4aa.chunk.js","sourcesContent":["\nexport class ApiError extends Error {\n  constructor(public status: number, message: string) {\n    super(message);\n    this.name = 'ApiError';\n  }\n}\n","import { ApiError } from \"./ApiError\";\n\n/**\n * bookmarkの並びを指定する\n * * 'updated_at' ブクマ更新順\n * * 'new' ブクマ追加順\n * * 'ncode' 新着Nコード順 \n * * 'newlist' 新着更新順\n */\ntype BookmarkOrder = 'updated_at' | 'new' | 'ncode' | 'newlist';\n\n/**\n * SWRのキーとして与え、 SWRのfetcherとして `key => NarouApi.call(key)` として渡す値。\n */\ntype NarouApiCallKey = string;\n\nexport class NarouApi {\n    private server: string;\n\n    constructor(server: string) {\n        this.server = server.replace(/\\/$/, '');\n    }\n\n    get baseUrl(): string { return this.server; }\n\n    async fetch(api: string): Promise<Response> {\n        return fetch(`${this.server}${api}`, {\n            credentials: 'include',\n        });\n    }\n\n    async login(id: string, password: string): Promise<Response> {\n        const formData = new FormData();\n        formData.append('id', id);\n        formData.append('password', password);\n        const res: Response = await fetch(`${this.server}/narou/login`, {\n            method: 'POST',\n            body: formData,\n            credentials: 'include',\n        });\n        return res;\n    }\n\n    async logout(): Promise<void> {\n        await this.fetch('/narou/logout');\n    }\n\n    async call(key: NarouApiCallKey) {\n        const res = await this.fetch(key);\n        if (!res.ok) {\n            throw new ApiError(res.status, await res.text());\n        }\n        return res.json();\n    }\n\n    static isnoticelist({ maxPage = 1 }: { maxPage: number }): NarouApiCallKey {\n        console.log('NarouApi.isnoticelist'); // DEBUG\n        return `/narou/isnoticelist?max_page=${maxPage}`;\n    }\n    static isnoticelistR18({ maxPage = 1 }: { maxPage: number }): NarouApiCallKey {\n        return `/r18/isnoticelist?max_page=${maxPage}`;\n    }\n\n    static bookmarks(): NarouApiCallKey {\n        return `/narou/bookmarks/`;\n    }\n    static bookmarksR18(): NarouApiCallKey {\n        return `/r18/bookmarks/`;\n    }\n\n    static bookmark(no: number, { order }: { order: BookmarkOrder }): NarouApiCallKey {\n        return `/narou/bookmarks/${no}?order=${order}`;\n    }\n    static bookmarkR18(no: number, { order }: { order: BookmarkOrder }): NarouApiCallKey {\n        return `/r18/bookmarks/${no}?order=${order}`;\n    }\n\n    static novelInfo(ncode: string): NarouApiCallKey {\n        return `/narou/novels/${ncode}`;\n    }\n    static novelInfoR18(ncode: string): NarouApiCallKey {\n        return `/r18/novels/${ncode}`;\n    }\n}","import { MenuItem, Select, useMediaQuery } from '@mui/material';\nimport { Breakpoint, useTheme } from '@mui/material/styles';\nimport { useState } from 'react';\nimport { BookmarkInfo } from './narouApi/useBookmarkInfo';\n\nfunction useIsWidthUp(breakpoint: Breakpoint) {\n  const theme = useTheme();\n  return useMediaQuery(theme.breakpoints.up(breakpoint));\n}\n\nexport function BookmarkSelector({ bookmarks, bookmark, onChangeBookmark: setBookmark }: {\n  bookmarks: BookmarkInfo | undefined;\n  bookmark: number;\n  onChangeBookmark: (newBookmark: number) => void;\n}) {\n  const [open, setOpen] = useState(false);\n  const large = useIsWidthUp('sm');\n\n  return (\n    <Select\n      disableUnderline={true}\n      variant=\"standard\"\n      open={open} onOpen={() => setOpen(true)} onClose={() => setOpen(false)}\n      value={bookmark} onChange={event => setBookmark(Number(event.target.value))}>\n      <MenuItem key={0} value={0}>{open || large ? 'ブックマークなし' : 'BM-'}</MenuItem>\n      {bookmarks && Object.keys(bookmarks).map(k => <MenuItem key={k} value={k}>{open || large ? bookmarks[Number(k)].name : `BM${bookmark}`}</MenuItem>)}\n    </Select>\n  );\n}","import { DateTime } from 'luxon';\n\nexport type IsNoticeListItem = {\n  base_url: string;\n  update_time: DateTime;\n  bookmark: number;\n  latest: number;\n  title: string;\n  author_name: string;\n  completed?: boolean;\n  isR18: boolean;\n};\n\n export function hasUnread(item: Pick<IsNoticeListItem, 'latest' | 'bookmark'>): boolean {\n  return item.latest > item.bookmark;\n}\n\nexport function nextLink(item: Pick<IsNoticeListItem, 'latest' | 'bookmark' | 'base_url'>): string {\n  if (hasUnread(item)) {\n    return `${item.base_url}${item.bookmark + 1}/`;\n  }\n  return `${item.base_url}${item.latest}/`;\n}\n\nexport function itemSummary(item: Pick<IsNoticeListItem, 'title' | 'bookmark' | 'latest' | 'completed'>): string {\n  const fields = [item.title, ' ('];\n  if (hasUnread(item)) {\n    fields.push(`${item.bookmark}/`);\n  }\n  fields.push(`${item.latest})`);\n  if (item.completed) {\n    fields.push('[完結]');\n  }\n  return fields.join('');\n}\n\nexport function unread(item: Pick<IsNoticeListItem, 'latest' | 'bookmark'>): number {\n  return Math.max(item.latest - item.bookmark, 0);\n}\n","import { useMemo } from \"react\"\nimport useSWR from \"swr\"\nimport { NarouApi } from \"./NarouApi\"\n\nexport type BookmarkInfo = {\n    [no: number]: {\n        name: string;\n        num_items: number;\n    }\n}\n\ntype BookmarkInfoRecord = {\n    no: number;\n    name: string;\n    num_items: number;\n}\n\nexport function useBookmarkInfo(api: NarouApi | null, r18: boolean) {\n    const { data, error } = useSWR<BookmarkInfoRecord[]>(\n        api ?\n            (r18 ? NarouApi.bookmarksR18() : NarouApi.bookmarks())\n            :\n            null,\n        async key => api ? api.call(key) : [],\n    )\n\n    const info: BookmarkInfo | undefined = useMemo(() => {\n        if (data) {\n            return data.reduce<BookmarkInfo>((a, d) => {\n                a[d.no] = {\n                    name: d.name,\n                    num_items: d.num_items,\n                };\n                return a;\n            }, {});\n        } else {\n            return undefined;\n        }\n    }, [data]);\n\n    return { data: info, error };\n}","import useSWR, { mutate } from 'swr';\nimport { useMemo } from 'react';\nimport { DateTime } from 'luxon';\nimport { NarouApi } from './NarouApi';\nimport { IsNoticeListItem } from './IsNoticeListItem';\n\ntype IsNoticeListRecord = {\n  base_url: string;\n  update_time: string;\n  bookmark: number;\n  latest: number;\n  title: string;\n  author_name: string;\n  completed?: boolean;\n  is_notice?: boolean; // only in bookmark\n};\n\n// login / logout したらキャッシュをすぐに消す\nexport function clearCache() {\n  mutate('/narou/isnoticelist');\n  mutate('/r18/isnoticelist');\n}\n\nexport function useIsNoticeList(\n  api: NarouApi,\n  { enableR18, maxPage = 1, bookmark = 0 }:\n    {\n      enableR18: boolean,\n      maxPage: number,\n      bookmark: number,\n    }\n) {\n  const { data: raw_items, error } = useSWR<IsNoticeListRecord[]>(NarouApi.isnoticelist({ maxPage }),\n    async path => api.call(path),\n    {\n      onErrorRetry: (error) => {\n        console.log(`onErrorRetry: ${error.status}: ${error}`);\n      },\n    });\n\n  // order: updated_at:ブクマ更新順, new:ブクマ追加順\n  const order: 'updated_at' | 'new' = 'new';\n  const { data: bookmark_items, error: bookmark_error } = useSWR<IsNoticeListRecord[]>((!error && bookmark) ? NarouApi.bookmark(bookmark, { order }) : null,\n    async path => api.call(path),\n  );\n\n  const { data: raw_items18, error: error18 } = useSWR<IsNoticeListRecord[]>((!error && enableR18) ? NarouApi.isnoticelistR18({ maxPage }) : null,\n    async path => api.call(path),\n  );\n\n  // merge bookmark\n  const raw_items2 = useMemo(() => {\n    if (raw_items) {\n      if (bookmark_items) {\n        const keys = new Set(raw_items.map(i => i.base_url));\n        const adds = bookmark_items.filter(i => i.is_notice && !keys.has(i.base_url));\n        if (adds.length > 0) {\n          return [...raw_items, ...adds];\n        }\n      }\n    }\n    return raw_items;\n  }, [raw_items, bookmark_items]);\n\n  const items: IsNoticeListItem[] | undefined = useMemo(\n    () => {\n      if (raw_items2 === undefined) {\n        return undefined;\n      }\n\n      // なろう、R18のアイテムを混ぜる\n      const n = [\n        ...raw_items2.map(i => ({ ...i, isR18: false })),\n        ...(raw_items18 || []).map(i => ({ ...i, isR18: true }))\n      ].map(i => ({ ...i, update_time: DateTime.fromISO(i.update_time) }));\n      return n;\n    },\n    [raw_items2, raw_items18]\n  );\n\n  return { data: error ? undefined : items, error: error || error18 || bookmark_error };\n}\n","import { Box, Button, Card, CardActions, CardContent, CardHeader, Container, Dialog, DialogActions, DialogContent, DialogTitle, TextField } from '@mui/material';\nimport { useCallback, useRef, useState } from 'react';\nimport { NarouApi } from './narouApi/NarouApi';\n\nexport function NarouLoginForm(props: { api: NarouApi; onLogin: () => void; }) {\n  const [userId, setUserId] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState<string>('');\n\n  const postLogin = useCallback(async () => {\n    const res: Response = await props.api.login(userId, password);\n    if (!res.ok) {\n      const text = await res.text();\n      setError(`${res.status} ${res.statusText}\\n${text}`);\n    } else {\n      props.onLogin();\n    }\n  }, [userId, password, props]);\n\n  const passwordRef = useRef<HTMLInputElement>();\n\n  const closeError = useCallback(() => {\n    setError('');\n    passwordRef.current?.focus();\n  }, []);\n\n  return (<>\n    <Dialog open={error !== ''} onClose={() => closeError()}>\n      <DialogTitle>ログインできませんでした</DialogTitle>\n      <DialogContent>\n        <pre>{error}</pre>\n      </DialogContent>\n      <DialogActions>\n        <Button autoFocus onClick={() => closeError()}>OK</Button>\n      </DialogActions>\n    </Dialog>\n    <Container maxWidth=\"sm\">\n      <Card raised={true} >\n        <CardHeader title=\"小説家になろうのログイン情報\" data-testid=\"login-page\">\n        </CardHeader>\n        <CardContent>\n          <Box display=\"flex\" flexDirection=\"column\" justifyContent=\"center\">\n            <TextField id=\"id\" name=\"id\" label=\"ID or email\" autoFocus\n              value={userId} onChange={e => setUserId(e.target.value)}\n              onKeyPress={e => {\n                if (e.key === 'Enter') {\n                  passwordRef.current?.focus();\n                }\n              }} data-testid=\"id\" />\n            <TextField id=\"password\" name=\"password\" label=\"password\" type=\"password\"\n              value={password} onChange={e => setPassword(e.target.value)}\n              inputRef={passwordRef} onKeyPress={e => {\n                if (e.key === 'Enter') {\n                  postLogin();\n                }\n              }} data-testid=\"password\" />\n          </Box>\n        </CardContent>\n        <CardActions style={{ justifyContent: \"center\" }}>\n          <Button variant=\"contained\" onClick={postLogin} data-testid=\"login\">login</Button>\n        </CardActions>\n      </Card>\n    </Container>\n  </>);\n}\n","import { NarouApi } from './NarouApi';\nimport useSWR from 'swr';\nimport { useMemo } from 'react';\n\ntype NovelInfo = {\n  base_url: string;\n  title: string;\n  abstract: string;\n  author_name: string;\n  author_url: string;\n  keywords: string[];\n  bookmark_url?: string;\n  bookmark_no?: number;\n  bookmark_episode?: number;\n};\n\nfunction extractInfoPath(base_url?: string): { host: string, ncode: string } | null {\n  if (!base_url) {\n    return null;\n  }\n\n  const m = base_url.match(/https:\\/\\/([0-9a-zA-Z.]+)\\/([0-9a-z]+)\\/?/);\n  if (!m) {\n    console.warn(`base_url is invalid: ${base_url}`);\n    return null;\n  }\n  const [, host, ncode] = m;\n  return { host, ncode };\n}\n\nexport function useNovelInfo(\n  api: NarouApi,\n  base_url?: string) {\n\n  const info = useMemo(() => extractInfoPath(base_url), [base_url]);\n  const key = useMemo(() => {\n    if (!info) {\n      return null;\n    }\n    switch (info.host) {\n      case 'ncode.syosetu.com':\n        return NarouApi.novelInfo(info.ncode);\n      case 'novel18.syosetu.com':\n        return NarouApi.novelInfoR18(info.ncode);\n      default:\n        console.warn(`unknown host: ${info.host}`);\n        return null;\n    }\n  }, [info])\n\n  const { data, error } = useSWR<NovelInfo>(key, async path => api.call(path));\n\n  return { data, error };\n}\n","import {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Link\n} from '@mui/material';\nimport { useMemo } from 'react';\nimport { IsNoticeListItem, nextLink } from './narouApi/IsNoticeListItem';\nimport { NarouApi } from './narouApi/NarouApi';\nimport { useBookmarkInfo } from './narouApi/useBookmarkInfo';\nimport { useNovelInfo } from './narouApi/useNovelInfo';\n\nexport function OpenConfirmDialog({ api, item, onClose }: {\n  api: NarouApi;\n  item?: IsNoticeListItem;\n  onClose: () => void;\n}) {\n  const { data: novelInfo } = useNovelInfo(api, item?.base_url);\n  const { data: bookmarkInfo } = useBookmarkInfo(novelInfo?.bookmark_no ? api : null, item?.isR18 || false);\n\n  const bookmark = useMemo(() => {\n    console.log('novelInfo:', novelInfo);\n    console.log('bookmarkInfo:', bookmarkInfo);\n    const bookmark_no = novelInfo?.bookmark_no\n    if (bookmarkInfo && bookmark_no && novelInfo?.bookmark_url) {\n      return {\n        no: bookmark_no,\n        name: bookmarkInfo[bookmark_no].name,\n        url: novelInfo.bookmark_url,\n      };\n    }\n    return undefined;\n  }, [novelInfo, bookmarkInfo])\n\n  return (\n    <Dialog open={!!item} onClose={onClose}>\n      <DialogTitle>{item?.title}</DialogTitle>\n      <DialogContent>作者:<Link href={novelInfo?.author_url} target=\"_blank\">{item?.author_name}</Link></DialogContent>\n      {bookmark && <DialogContent>ブックマーク:<Link href={bookmark.url} target=\"_blank\">{bookmark.name}</Link></DialogContent>}\n      <DialogActions>\n        <Button size=\"small\" variant=\"contained\" onClick={() => {\n          if (item)\n            window.open(item.base_url, '_blank');\n          onClose();\n        }}>小説ページ</Button>\n        <Button size=\"small\" variant=\"contained\" onClick={() => {\n          if (item)\n            window.open(nextLink(item), '_blank');\n          onClose();\n        }}>最新{item?.latest}部分</Button>\n        <Button size=\"small\" variant=\"contained\" onClick={() => onClose()}>キャンセル</Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","import { IsNoticeListItem } from \"../narouApi/IsNoticeListItem\";\n\nexport type ItemsState = {\n  items?: IsNoticeListItem[];\n  numNewItems: number | null;\n  selectedIndex: number;\n  defaultIndex: number;\n};\n\nexport const InitialItemsState: ItemsState = {\n  numNewItems: null,\n  selectedIndex: -1,\n  defaultIndex: -1,\n};\n\nexport type StateAction =\n  | { type: 'set', items: IsNoticeListItem[] | undefined }\n  | { type: 'select', index: number }\n\nexport function itemsStateReducer(state: ItemsState, action: StateAction): ItemsState {\n  switch (action.type) {\n    case 'set':\n      {\n        if (!action.items) {\n          return InitialItemsState;\n        }\n\n        // 未読があって少ない順にし、未読がある場合、同じ未読数同士は更新日時昇順、未読がない場合は更新日時降順\n        const items = action.items.sort((a, b) => {\n          return compare(a, b,\n            i => score(i),\n            a.bookmark < a.latest ?\n              i => i.update_time :\n              reverse(i => i.update_time),\n            i => i.base_url);\n        })\n          .slice(0, 30);\n\n        const head = items[0];\n        const index = head && head.bookmark < head.latest ? 0 : -1;\n        return {\n          ...state,\n          items,\n          numNewItems: items.filter(i => i.bookmark < i.latest).length,\n          selectedIndex: index,\n          defaultIndex: index,\n        };\n      }\n\n    case 'select':\n      return {\n        ...state,\n        selectedIndex: state.items ? Math.max(Math.min(action.index, state.items.length - 1), -1) : -1,\n      }\n  }\n}\n\n// sort用の比較関数\nfunction ascend<T>(a: T, b: T, f: (v: T) => any): -1 | 0 | 1 {\n  const fa = f(a), fb = f(b);\n  if (fa < fb) return -1;\n  if (fa > fb) return 1;\n  return 0;\n}\n\ntype Reverse<T> = {\n  f: (v: T) => any\n}\nfunction reverse<T>(f: (v: T) => any): Reverse<T> {\n  return { f };\n}\n\nfunction compare<T>(a: T, b: T, ...cmps: (((v: T) => any) | Reverse<T>)[]): -1 | 0 | 1 {\n  for (const f of cmps) {\n    let c;\n    if (typeof f === 'object') {\n      c = ascend(b, a, (f as Reverse<T>).f);\n    } else {\n      c = ascend(a, b, f);\n    }\n    if (c) return c;\n  }\n  return 0;\n}\n\nconst score = (i: IsNoticeListItem) => {\n  if (i.bookmark === i.latest) return Number.MAX_SAFE_INTEGER;\n  if (i.bookmark > i.latest) return Number.MAX_SAFE_INTEGER - 1;\n  return i.latest - i.bookmark;\n}\n","import { useEffect, useState } from 'react';\n\nexport type HotKeys = {\n  [key: string]: (event: KeyboardEvent) => void;\n}\n\nfunction toKeyString(event: { key: string; shiftKey: boolean; ctrlKey: boolean; altKey: boolean; metaKey: boolean }): string {\n  return [\n    event.shiftKey ? 'shift' : undefined,\n    event.ctrlKey ? 'ctrl' : undefined,\n    event.altKey ? 'alt' : undefined,\n    event.metaKey ? 'meta' : undefined,\n    event.key,\n  ].filter(s => s !== undefined).join('+')\n}\n\nexport function checkKeyString(keyString: string) {\n  const [key, ...elems] =\n    keyString === '+'\n      ? ['+']\n      : keyString.endsWith('++')\n        ? ['+', ...keyString.slice(0, -2).split('+').reverse()]\n        : keyString.split('+').reverse();\n\n  const availableModifiers = ['shift', 'ctrl', 'alt', 'meta'];\n  if (elems.some(s => !availableModifiers.includes(s))) {\n    throw new Error(`HotKey(${keyString}): unknown modifiers: ${elems.filter(s => !availableModifiers.includes(s))}`);\n  }\n\n  const shouldBe = toKeyString({\n    key,\n    shiftKey: elems.some(s => s === 'shift'),\n    ctrlKey: elems.some(s => s === 'ctrl'),\n    altKey: elems.some(s => s === 'alt'),\n    metaKey: elems.some(s => s === 'meta'),\n  });\n\n  if (shouldBe !== keyString) {\n    throw new Error(`HotKey(${keyString}): invalid order: must be ${shouldBe} `);\n  }\n}\n\nexport function useHotKeys() {\n  const [hotkeys, setHotkeys] = useState<HotKeys>({});\n\n  useEffect(() => {\n    const keys = Object.keys(hotkeys);\n    if (keys.length > 0) {\n      keys.forEach(key => checkKeyString(key));\n\n      const onKeyDown = (event: KeyboardEvent) => {\n        const handler = hotkeys[toKeyString(event)];\n        if (handler) {\n          handler(event);\n        }\n      };\n      document.addEventListener('keydown', onKeyDown, false);\n      return () => {\n        document.removeEventListener('keydown', onKeyDown);\n      };\n    }\n  }, [hotkeys]);\n\n  return [setHotkeys];\n}\n","import { Book, Info } from '@mui/icons-material';\nimport {\n  AppBar,\n  Avatar,\n  Backdrop,\n  Badge,\n  BadgeTypeMap,\n  Box,\n  Button,\n  CircularProgress,\n  Fab,\n  FormControlLabel,\n  IconButton,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemSecondaryAction,\n  ListItemText,\n  Switch,\n  Theme,\n  Toolbar\n} from '@mui/material';\nimport createStyles from '@mui/styles/createStyles';\nimport makeStyles from '@mui/styles/makeStyles';\nimport { useCallback, useEffect, useReducer, useRef, useState } from 'react';\nimport scrollIntoView from 'scroll-into-view-if-needed';\nimport { BookmarkSelector } from './BookmarkSelector';\nimport { IsNoticeListItem, itemSummary, nextLink, unread } from \"./narouApi/IsNoticeListItem\";\nimport { NarouApi } from './narouApi/NarouApi';\nimport { BookmarkInfo, useBookmarkInfo } from './narouApi/useBookmarkInfo';\nimport { clearCache, useIsNoticeList } from './narouApi/useIsNoticeList';\nimport { NarouLoginForm } from './NarouLoginForm';\nimport { OpenConfirmDialog } from './OpenConfirmDialog';\nimport { InitialItemsState, itemsStateReducer } from './reducer/ItemsState';\nimport { useAppBadge, useClientBadge } from './useAppBadge';\nimport { useHotKeys } from './useHotKeys';\n\nconst UserTopURL = 'https://syosetu.com/user/top/';\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    backdrop: {\n      zIndex: theme.zIndex.drawer + 1,\n      color: '#fff',\n    },\n  }),\n);\n\nfunction badgeProps(item: IsNoticeListItem): BadgeTypeMap['props'] {\n  if (item.latest < item.bookmark) {\n    return { color: 'secondary', badgeContent: '!' };\n  }\n  return { color: 'primary', badgeContent: unread(item) };\n}\n\nfunction maxPageValue(sw: boolean): number {\n  return sw ? 2 : 1;\n}\n\nexport function nextBookmark(bookmarks: BookmarkInfo, cur: number): number {\n  const numbers = Object.keys(bookmarks).map(k => Number(k));\n  for (const i of numbers) {\n    if (i > cur) {\n      return i;\n    }\n  }\n  return 0;\n}\n\nexport function prevBookmark(bookmarks: BookmarkInfo, cur: number): number {\n  const numbers = [0, ...Object.keys(bookmarks).map(k => Number(k))];\n  const i = numbers.findIndex(i => i >= cur);\n  if (i > 0) {\n    return numbers[i - 1];\n  }\n  return numbers[numbers.length - 1];\n}\n\nfunction NarouUpdateList({ server, onUnauthorized }: { server: NarouApi, onUnauthorized: () => void }) {\n  const classes = useStyles();\n\n  const [enableR18, setEnableR18] = useState(false);\n  const [maxPage, setMaxPage] = useState(maxPageValue(false));\n  const [bookmark, setBookmark] = useState(0);\n\n  const { data: rawItems, error } = useIsNoticeList(server, { enableR18, maxPage, bookmark });\n  const { data: bookmarks } = useBookmarkInfo(server, false);\n\n  const [{ items, numNewItems, selectedIndex, defaultIndex }, dispatch] = useReducer(itemsStateReducer, InitialItemsState)\n\n  useEffect(() => {\n    dispatch({ type: 'set', items: rawItems })\n  }, [rawItems]);\n  const setSelectedIndex = (index: number) => dispatch({ type: 'select', index });\n\n  const [confirm, setConfirm] = useState<IsNoticeListItem | undefined>(undefined);\n\n  const { setAppBadge, clearAppBadge } = useAppBadge();\n  const { setClientBadge, clearClientBadge } = useClientBadge();\n\n  useEffect(() => {\n    if (numNewItems !== null) {\n      document.title = `なろう 未読:${numNewItems}`;\n      if (numNewItems) {\n        setAppBadge(numNewItems);\n        setClientBadge(numNewItems);\n      } else {\n        clearAppBadge();\n        clearClientBadge();\n      }\n    }\n  }, [clearAppBadge, clearClientBadge, numNewItems, setAppBadge, setClientBadge]);\n\n  const scrollIn = useCallback(node => {\n    if (node) {\n      scrollIntoView(node, { behavior: 'smooth', scrollMode: 'if-needed' });\n      node.focus();\n    }\n  }, []);\n\n  const defaultRef = useRef<HTMLButtonElement>(null);\n\n  useEffect(() => {\n    if (selectedIndex === -1) {\n      defaultRef.current?.focus();\n    }\n  }, [selectedIndex]);\n\n  const [setHotKeys] = useHotKeys();\n\n  useEffect(() => {\n    if (items) {\n      const len = items.length;\n      const arrowUp = (event: KeyboardEvent) => {\n        event.preventDefault();\n        dispatch({ type: 'select', index: selectedIndex - 1 });\n      }\n      const arrowDown = (event: KeyboardEvent) => {\n        event.preventDefault();\n        dispatch({ type: 'select', index: selectedIndex + 1 });\n      }\n\n      setHotKeys({\n        ...(selectedIndex > 0 && {\n          'ArrowUp': arrowUp,\n          'k': arrowUp,\n        }),\n        ...(selectedIndex < len - 1 && {\n          'ArrowDown': arrowDown,\n          'j': arrowDown,\n        }),\n        ...(len > 0 && {\n          'Home': () => setSelectedIndex(0),\n          'End': () => setSelectedIndex(len - 1),\n          'Escape': () => setSelectedIndex(defaultIndex),\n        }),\n        'r': () => setEnableR18(v => !v),\n        '1': () => setMaxPage(v => maxPageValue(v === maxPageValue(false))),\n        'h': () => window.open(UserTopURL, '_blank'),\n        ...(bookmarks && {\n          'b': () => setBookmark(nextBookmark(bookmarks, bookmark)),\n          'shift+B': () => setBookmark(prevBookmark(bookmarks, bookmark)),\n        })\n      });\n    }\n  }, [selectedIndex, defaultIndex, items, bookmarks, bookmark, setHotKeys]);\n\n  const buttonProps = useCallback((item: IsNoticeListItem) => {\n    if (unread(item) > 0) {\n      return {\n        component: 'a',\n        href: nextLink(item),\n        onClick: () => setSelectedIndex(-1), // workaround against remaining focus style\n        target: '_blank',\n      };\n    } else {\n      return { disabled: true };\n    }\n  }, []);\n\n  if (error) {\n    console.log(`error = ${error}`);\n    if (error.status === 401) {\n      onUnauthorized();\n    }\n    return <div onClick={() => window.location.reload()}>\n      <p>Server({JSON.stringify(server.baseUrl)}) is not working...?</p>\n      <p>status: {error.status}</p>\n      <code>{error.message}</code>\n    </div>;\n  }\n  if (!items) {\n    return <Backdrop className={classes.backdrop} open={true}>\n      <CircularProgress color=\"inherit\" />\n    </Backdrop>\n  }\n\n  return <>\n    <OpenConfirmDialog api={server} item={confirm} onClose={() => setConfirm(undefined)} />\n    <AppBar position=\"sticky\">\n      <Toolbar>\n        <Box>\n          <FormControlLabel\n            label=\"R18\"\n            control={\n              <Switch\n                checked={enableR18}\n                onChange={event => setEnableR18(event.target.checked)}\n              />}\n          />\n        </Box>\n        <Box>\n          <BookmarkSelector bookmarks={bookmarks} bookmark={bookmark} onChangeBookmark={setBookmark} />\n        </Box>\n        <Box m={2}>未読: {numNewItems ?? ''}</Box>\n        <Button\n          variant=\"contained\"\n          disabled={selectedIndex === 0}\n          disableRipple={true}\n          ref={defaultRef}\n          onClick={() => setSelectedIndex(defaultIndex)}>ESC</Button>\n      </Toolbar>\n    </AppBar>\n    <Box m={2} display=\"flex\" alignItems=\"center\" flexDirection=\"column\" bgcolor=\"background.paper\">\n      <Box maxWidth={600}>\n        <List>\n          {items?.map((item, index) =>\n            <ListItem key={item.base_url} button={true}\n              {...(index === selectedIndex ? { selected: true, ref: scrollIn } : {})}\n              disableRipple={true}\n              onFocusVisible={() => setSelectedIndex(index)}\n              {...buttonProps(item)} >\n              <ListItemAvatar>\n                <Badge overlap=\"circular\" {...badgeProps(item)} >\n                  <Avatar>\n                    <Book color={item.isR18 ? \"secondary\" : undefined} />\n                  </Avatar>\n                </Badge>\n              </ListItemAvatar>\n              <ListItemText\n                primary={itemSummary(item)}\n                secondary={`${item.update_time.toFormat('yyyy/LL/dd HH:mm')} 更新  作者:${item.author_name}`} />\n              <ListItemSecondaryAction>\n                <IconButton\n                  edge=\"end\"\n                  onClick={() => setConfirm(item)}\n                  disableRipple={true}\n                  size=\"large\">\n                  <Info />\n                </IconButton>\n              </ListItemSecondaryAction>\n            </ListItem>)}\n        </List>\n      </Box>\n      <Box position=\"fixed\" right=\"20px\" bottom=\"20px\">\n        <Fab\n          variant=\"extended\"\n          size=\"small\"\n          disableRipple={true}\n          component=\"a\"\n          href={UserTopURL}\n          target=\"_blank\"\n        >ユーザーホーム</Fab>\n      </Box>\n    </Box>\n  </>;\n}\n\nexport function NarouUpdates({ api }: { api: NarouApi }) {\n  const [loginMode, setLoginMode] = useState(false);\n\n  const onUnauthorized = useCallback(() => {\n    setTimeout(() => {\n      clearCache();\n      setLoginMode(true)\n    }, 0);\n  }, []);\n\n  if (loginMode) {\n    return <NarouLoginForm api={api} onLogin={() => {\n      console.log('logged in!');\n      clearCache();\n      setLoginMode(false);\n    }} />\n  }\n\n  return (\n    <>\n      <NarouUpdateList server={api}\n        onUnauthorized={onUnauthorized} />\n      <Button onClick={async () => {\n        await api.logout();\n        clearCache();\n        setLoginMode(true);\n      }}>logout</Button>\n    </>\n  );\n}\n","export function useAppBadge(): { setAppBadge: (count?: number) => Promise<void>; clearAppBadge: () => Promise<void>; } {\n  if ('setAppBadge' in navigator && 'clearAppBadge' in navigator) {\n    return {\n      setAppBadge: (count) => (navigator as any).setAppBadge(count),\n      clearAppBadge: () => (navigator as any).clearAppBadge(),\n    };\n  } else {\n    return {\n      setAppBadge: () => Promise.resolve(),\n      clearAppBadge: () => Promise.resolve(),\n    };\n  }\n}\n\nexport function useClientBadge(): { setClientBadge: (count?: number) => Promise<void>; clearClientBadge: () => Promise<void>; } {\n  if ('setClientBadge' in navigator && 'clearClientBadge' in navigator) {\n    return {\n      setClientBadge: (count) => (navigator as any).setClientBadge(count),\n      clearClientBadge: () => (navigator as any).clearClientBadge(),\n    };\n  } else {\n    return {\n      setClientBadge: () => Promise.resolve(),\n      clearClientBadge: () => Promise.resolve(),\n    };\n  }\n}\n\n","//import './App.css';\nimport { CssBaseline, Link, Typography, useMediaQuery } from '@mui/material';\nimport { cyan } from '@mui/material/colors';\nimport { createTheme, StyledEngineProvider, Theme, ThemeProvider } from '@mui/material/styles';\nimport { DateTime } from 'luxon';\nimport preval from 'preval.macro';\nimport { useEffect, useMemo, useState } from 'react';\nimport { SWRConfig } from 'swr';\nimport { NarouApi } from './narouApi/NarouApi';\nimport { NarouUpdates } from './NarouUpdates';\n\ndeclare module '@mui/styles/defaultTheme' {\n  // eslint-disable-next-line @typescript-eslint/no-empty-interface\n  interface DefaultTheme extends Theme { }\n}\n\nconst PollingInterval = 5 * 60 * 1000; // 5分ごとにポーリング\n\nconst buildDate: string = preval`module.exports = new Date().toISOString();`\n\nfunction getServerAddress(location: Location): string {\n  const server = new URLSearchParams(location.search).get('server')\n  if (server) {\n    return server;\n  }\n  if (location.protocol === 'http:') {\n    return 'http://localhost:7676';\n  }\n  // github.io であればAPIは置けないから除外\n  if (!/.*\\.github\\.io$/.test(location.hostname)) {\n    // 置いてるサイトにAPIがあると期待する\n    return location.protocol + '//' + location.host + location.pathname;\n  }\n  return '';\n}\n\nfunction App() {\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');\n\n  const theme = useMemo(\n    () =>\n      createTheme({\n        palette: {\n          mode: prefersDarkMode ? 'dark' : 'light',\n          primary: cyan,\n        },\n      }),\n    [prefersDarkMode],\n  );\n\n  const [api, setApi] = useState<NarouApi | null>(null);\n  const [hostError, setHostError] = useState(false);\n  useEffect(() => {\n    const host = getServerAddress(document.location);\n    if (host) {\n      setApi(new NarouApi(host));\n    } else {\n      setHostError(true);\n    }\n  }, [])\n\n  if (hostError) {\n    return (\n      <StyledEngineProvider injectFirst>\n        <ThemeProvider theme={theme}>\n          <Typography>http以外の場合は必ず server クエリパラメータにサーバーアドレスを指定してください</Typography>\n          <Link href=\"https://github.com/koizuka/narou-watcher/\">GitHub</Link>\n        </ThemeProvider>\n      </StyledEngineProvider>\n    );\n  }\n\n  return (\n    <StyledEngineProvider injectFirst>\n      <ThemeProvider theme={theme}>\n        <CssBaseline />\n        <SWRConfig value={{\n          refreshInterval: PollingInterval,\n        }}>\n          {api && <NarouUpdates api={api} />}\n        </SWRConfig>\n        <div style={{\n          display: \"inline-block\",\n          position: \"fixed\",\n          bottom: 0,\n          right: 0,\n          fontSize: \"small\",\n          fontStyle: \"italic\",\n        }}>narou-react: {DateTime.fromISO(buildDate).toISO()}</div>\n      </ThemeProvider>\n    </StyledEngineProvider>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}