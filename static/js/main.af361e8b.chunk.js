(this["webpackJsonpnarou-react"]=this["webpackJsonpnarou-react"]||[]).push([[0],{89:function(e,t,n){},97:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(10),o=n.n(a),i=(n(89),n(21)),u=n(31),s=n(35),l=n(11),j=n.n(l),b=n(16),d=n(142),f=n(130),h=n(145),p=n(129),O=n(131),v=n(132),m=n(133),x=n(146),g=n(135),k=n(134),y=n(32),w=n(59);var S=n(144),_=n(126),D=n(127),C=n(128),E=n(140),R=n(6);function F(e){var t=Object(r.useState)(""),n=Object(i.a)(t,2),c=n[0],a=n[1],o=Object(r.useState)(""),u=Object(i.a)(o,2),s=u[0],l=u[1],f=Object(r.useState)(""),h=Object(i.a)(f,2),O=h[0],v=h[1],m=Object(r.useCallback)(Object(b.a)(j.a.mark((function t(){var n,r;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api.login(c,s);case 2:if((n=t.sent).ok){t.next=10;break}return t.next=6,n.text();case 6:r=t.sent,v("".concat(n.status," ").concat(n.statusText,"\n").concat(r)),t.next=11;break;case 10:e.onLogin();case 11:case"end":return t.stop()}}),t)}))),[c,s,e]),x=Object(r.useRef)(),g=Object(r.useCallback)((function(){var e;v(""),null===(e=x.current)||void 0===e||e.focus()}),[]);return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsxs)(S.a,{open:""!==O,onClose:function(){return g()},children:[Object(R.jsx)(_.a,{children:"\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f"}),Object(R.jsx)(D.a,{children:Object(R.jsx)("pre",{children:O})}),Object(R.jsx)(C.a,{children:Object(R.jsx)(p.a,{autoFocus:!0,onClick:function(){return g()},children:"OK"})})]}),Object(R.jsxs)("form",{id:"loginForm",children:[Object(R.jsx)("h2",{children:"\u5c0f\u8aac\u5bb6\u306b\u306a\u308d\u3046\u306e\u30ed\u30b0\u30a4\u30f3\u60c5\u5831"}),Object(R.jsx)(d.a,{children:Object(R.jsx)(E.a,{id:"id",name:"id",label:"ID or email",autoFocus:!0,value:c,onChange:function(e){return a(e.target.value)},onKeyPress:function(e){var t;"Enter"===e.key&&(null===(t=x.current)||void 0===t||t.focus())}})}),Object(R.jsx)(d.a,{children:Object(R.jsx)(E.a,{id:"password",name:"password",label:"password",type:"password",value:s,onChange:function(e){return l(e.target.value)},inputRef:x,onKeyPress:function(e){"Enter"===e.key&&m()}})}),Object(R.jsx)(p.a,{onClick:m,children:"login"})]})]})}function L(e){return e.bookmark>=e.latest?"".concat(e.base_url).concat(e.latest,"/"):"".concat(e.base_url).concat(e.bookmark+1,"/")}function T(e){return e.latest>e.bookmark}function I(e){return Math.max(e.latest-e.bookmark,0)}function M(e){var t=e.server,n=e.ignoreDuration,c=e.onUnauthorized,a=Object(r.useState)(!1),o=Object(i.a)(a,2),l=o[0],S=o[1],_=function(e,t){var n=t.ignoreDuration,c=t.enableR18,a=Object(u.b)("/narou/isnoticelist",function(){var t=Object(b.a)(j.a.mark((function t(n){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.call(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),{onErrorRetry:function(e){console.log("onErrorRetry:",e,e.status)}}),o=a.data,i=a.error,l=Object(u.b)(!i&&c?"/r18/isnoticelist":null,function(){var t=Object(b.a)(j.a.mark((function t(n){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.call(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),d=l.data,f=l.error,h=Object(r.useMemo)((function(){if(void 0!==o){var e=s.DateTime.now().minus(n);return[].concat(Object(w.a)(o.map((function(e){return Object(y.a)(Object(y.a)({},e),{},{isR18:!1})}))),Object(w.a)((d||[]).map((function(e){return Object(y.a)(Object(y.a)({},e),{},{isR18:!0})})))).map((function(e){return Object(y.a)(Object(y.a)({},e),{},{update_time:s.DateTime.fromISO(e.update_time)})})).filter((function(t){return t.update_time>e})).sort((function(e,t){return e.update_time>t.update_time?-1:e.update_time<t.update_time?1:0}))}}),[o,d,n]);return{data:i?void 0:h,error:i||f}}(t,{ignoreDuration:n,enableR18:l}),D=_.data,C=_.error,E=Object(r.useMemo)((function(){return null===D||void 0===D?void 0:D.filter((function(e){return e.bookmark<e.latest}))}),[D]),F=Object(r.useMemo)((function(){return E&&E.length>0?E[E.length-1]:void 0}),[E]),M=Object(r.useMemo)((function(){return F?L(F):void 0}),[F]);if(Object(r.useEffect)((function(){document.title="\u306a\u308d\u3046 \u672a\u8aad:".concat(null===E||void 0===E?void 0:E.length)}),[E]),Object(r.useEffect)((function(){if(void 0!==M){var e=function(e){"Enter"===e.key&&window.open(M,"_blank")};return document.addEventListener("keydown",e,!1),function(){document.removeEventListener("keydown",e)}}}),[M]),C)return console.log("error =",C),401===C.status&&c(),Object(R.jsxs)("div",{children:["Server(",JSON.stringify(t),") is not working...?"]});if(!D)return Object(R.jsx)("div",{children:"Loading..."});var P=function(e){return!!F&&e.base_url===F.base_url};return Object(R.jsxs)(d.a,{m:2,display:"flex",flexDirection:"column",bgcolor:"background.paper",children:[Object(R.jsx)("p",{children:Object(R.jsx)(f.a,{label:"R18\u3092\u542b\u3081\u308b",control:Object(R.jsx)(h.a,{checked:l,onChange:function(e){return S(e.target.checked)}})})}),Object(R.jsx)("p",{children:"\u672a\u8aad: ".concat(null===E||void 0===E?void 0:E.length," \u4f5c\u54c1.")}),null===D||void 0===D?void 0:D.map((function(e){return Object(R.jsx)(d.a,{width:"100%",children:Object(R.jsx)(p.a,{variant:P(e)?"contained":"outlined",href:L(e),target:"_blank",children:Object(R.jsxs)(O.a,{children:[Object(R.jsx)(v.a,{children:Object(R.jsx)(m.a,{color:"primary",badgeContent:I(e),children:Object(R.jsx)(x.a,{children:Object(R.jsx)(k.a,{color:e.isR18?"secondary":void 0})})})}),Object(R.jsx)(g.a,{primary:T(e)?"".concat(e.title," (").concat(e.bookmark,"/").concat(e.latest,")"):"".concat(e.title," (").concat(e.latest,")"),secondary:"".concat(e.update_time.toFormat("yyyy/LL/dd HH:mm")," \u66f4\u65b0  \u4f5c\u8005:").concat(e.author_name)})]})})},e.base_url)}))]})}function P(e){var t=e.api,n=e.ignoreDuration,c=Object(r.useState)(!1),a=Object(i.a)(c,2),o=a[0],s=a[1];return Object(r.useEffect)((function(){Object(u.c)("/narou/isnoticelist"),Object(u.c)("/r18/isnoticelist")}),[o]),o?Object(R.jsx)(F,{api:t,onLogin:function(){console.log("logged in!"),s(!1)}}):Object(R.jsxs)(d.a,{children:[Object(R.jsx)(M,{server:t,ignoreDuration:n,onUnauthorized:function(){return s(!0)}}),Object(R.jsx)(p.a,{onClick:Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.logout();case 2:s(!0);case 3:case"end":return e.stop()}}),e)}))),children:"logout"})]})}var z=n(73),H=n(137),J=n(136),K=n(33),U=n(138),B=n(139),$=n(71),G=n(72),N=function(){function e(t){Object($.a)(this,e),this.server=void 0,this.server=t.replace(/\/$/,"")}return Object(G.a)(e,[{key:"fetch",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("".concat(this.server).concat(t),{credentials:"include"}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}())},{key:"login",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FormData).append("id",t),r.append("password",n),e.next=5,fetch("".concat(this.server,"/narou/login"),{method:"POST",body:r,credentials:"include"});case 5:return c=e.sent,e.abrupt("return",c);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch("/narou/logout");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"call",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(t);case 2:if((n=e.sent).ok){e.next=5;break}throw n;case 5:return e.abrupt("return",n.json());case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Z=s.Duration.fromObject({days:30});var q=function(){var e=Object(J.a)("(prefers-color-scheme: dark)"),t=Object(r.useMemo)((function(){return Object(z.a)({palette:{type:e?"dark":"light"}})}),[e]),n=Object(r.useState)(null),c=Object(i.a)(n,2),a=c[0],o=c[1];return Object(r.useEffect)((function(){var e,t=(e=document.location,new URLSearchParams(e.search).get("server")||("http:"===e.protocol?"http://localhost:7676":/.*\.github\.io$/.test(e.hostname)?"":e.protocol+"//"+e.host+e.pathname));o(t?new N(t):null)}),[]),a?Object(R.jsxs)(H.a,{theme:t,children:[Object(R.jsx)(B.a,{}),Object(R.jsx)(u.a,{value:{refreshInterval:3e5},children:Object(R.jsx)(P,{api:a,ignoreDuration:Z})}),Object(R.jsxs)("div",{style:{display:"inline-block",position:"fixed",bottom:0,right:0,fontSize:"small",fontStyle:"italic"},children:["narou-react: ",s.DateTime.fromISO("2021-04-22T13:12:01.167Z").toISO()]})]}):Object(R.jsxs)(H.a,{theme:t,children:[Object(R.jsx)(K.a,{children:"http\u4ee5\u5916\u306e\u5834\u5408\u306f\u5fc5\u305a server \u30af\u30a8\u30ea\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u30b5\u30fc\u30d0\u30fc\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044"}),Object(R.jsx)(U.a,{href:"https://github.com/koizuka/narou-watcher/",children:"GitHub"})]})},A=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,149)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),a(e),o(e)}))};o.a.render(Object(R.jsx)(c.a.StrictMode,{children:Object(R.jsx)(q,{})}),document.getElementById("root")),A()}},[[97,1,2]]]);
//# sourceMappingURL=main.af361e8b.chunk.js.map